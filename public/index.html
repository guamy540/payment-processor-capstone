<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scottish Rite Scholarship Foundation of Washington - Donate</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="./styles/navFooter.css" rel="stylesheet">
    <link href="./styles/index.css" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://js.stripe.com/v3/"></script>

    <script>

        //get the navbar.html file
        function loadNavbar() {
          fetch('./components/navbar.html')
            .then(response => response.text())
            .then(data => {
              document.querySelector('.navbar-container').innerHTML = data;
            });
        }

        //get the footer.html file
        function loadFooter(){
            fetch('./components/footer.html')
            .then(response => response.text())
            .then(data => {
              document.querySelector('.footer-container').innerHTML = data;
            });
        }
      
        loadNavbar();
        loadFooter();
      </script>

</head>

<body>

    <div class="navbar-container"></div>

    <main class="mainContainer">
        <div class="contentContainer">
            <h1 class="text-center pageTitle">Donate to the Scottish Rite Scholarship Foundation of Washington</h1>
            <form id="payment-form" class="paymentForm">
                <div class="form-group">
                    <label for="name">Full Name</label>
                    <input type="text" class="form-control" id="name" placeholder="John Doe" required>
                </div>
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" class="form-control" id="email" placeholder="name@example.com" required>
                </div>
                <div class="form-group">
                    <label for="amount">Donation Amount (USD)</label>
                    <input type="number" class="form-control" id="amount" min="1" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="card-element">Credit or Debit Card</label>
                    <div id="card-element" class="form-control"></div>
                    <div id="card-errors" role="alert" class="text-danger mt-2"></div>
                </div>
                <button id="submit-button" class="btn btn-primary btn-block donateButton">Donate Now</button>
            </form>
            <iframe class='testMap' src="https://www.google.com/maps/d/u/0/embed?mid=1PCKtMH6ywu_imeVvGJl8KqIM8Tacifs&ehbc=2E312F" width="640" height="480"></iframe>   </div>
        
    </main>

    <div class="footer-container"></div>

    <script>
        // Replace with your own Stripe public key
        const stripe = Stripe('your_stripe_public_key');
        const elements = stripe.elements();
        const cardElement = elements.create('card');
        cardElement.mount('#card-element');
        const form = document.getElementById('payment-form');
        const submitButton = document.getElementById('submit-button');

        form.addEventListener('submit', async (event) => {
            event.preventDefault();

            submitButton.disabled = true;

        // const result = await stripe.createToken(cardElement);

        /*    if (result.error) {
        //      document.getElementById('card-errors').textContent = result.error.message;
                submitButton.disabled = false;
            } else {
                // Send the token to your server to process the payment
                const response = await fetch('/process_payment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        token: result.token.id,
                        name: document.getElementById('name').value,
                        email: document.getElementById('email').value,
                        amount: document.getElementById('amount').value
                    })
                });

                if (response.ok) {
                    alert('Payment successful. Thank you for your donation!');
                    location.reload();
                } else {
                    alert('Payment failed. Please try again.');
                    submitButton.disabled = false;
                }
            }*/
            const response = await fetch('/process_payment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: document.getElementById('name').value,
                        email: document.getElementById('email').value,
                        amount: document.getElementById('amount').value
                    })
                });

                if (response.ok) {
                    alert('Payment successful. Thank you for your donation!');
                    location.reload();
                } else {
                    alert('Payment failed. Please try again.');
                    submitButton.disabled = false;
                }
        });
    </script>
</body>
</html>